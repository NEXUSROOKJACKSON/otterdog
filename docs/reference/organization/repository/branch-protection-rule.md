Definition of a Branch Protection Rule, the following properties are supported:

| Key                                | Value                                  | Description                                                                                                                                                                                       | Notes                                                                                                                                                                                                                                                                                                                |
|------------------------------------|----------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| _pattern_                          | string                                 | Pattern to match branches that shall be protected by this branch protection rule                                                                                                                  | Pattern follows [fnmatch syntax](https://ruby-doc.org/core-2.5.1/File.html#method-c-fnmatch), see [doc@GitHub](https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/managing-protected-branches/managing-a-branch-protection-rule#about-branch-protection-rules) for more info |
| _requires_pull_request_            | boolean                                | If enabled, requires a pull request before merging. All commits must be made to a non-protected branch and submitted via a pull request before they can be merged into protected branch(es)       |                                                                                                                                                                                                                                                                                                                      |
| _required_approving_review_count_  | integer or null                        | TBD                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                      |
| _dismisses_stale_reviews_          | boolean                                | Dismiss approved reviews automatically when a new commit is pushed                                                                                                                                |                                                                                                                                                                                                                                                                                                                      |
| _requires_code_owner_reviews_      | boolean                                | If reviews from code owners are required to update matching branches                                                                                                                              |                                                                                                                                                                                                                                                                                                                      |
| _restricts_review_dismissals_      | boolean                                | If only allowed actors can dismiss reviews on pull requests                                                                                                                                       |                                                                                                                                                                                                                                                                                                                      |
| _review_dismissal_allowances_      | list\[[Actor](actor.md)\]              | List of actors that are permitted to dismiss reviews on pull requests                                                                                                                             |                                                                                                                                                                                                                                                                                                                      |
| _bypass_pull_request_allowances_   | list\[[Actor](actor.md)\]              | List of actors able to bypass PRs for this branch protection rule                                                                                                                                 |                                                                                                                                                                                                                                                                                                                      |
| _require_last_push_approval_       | boolean                                | Whether the most recent push must be approved by someone other than the person who pushed it                                                                                                      |                                                                                                                                                                                                                                                                                                                      |
| _requires_status_checks_           | boolean                                | TBD                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                      |
| _requires_strict_status_checks_    | boolean                                | TBD                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                      |
| _required_status_checks_           | list\[[StatusCheck](status-check.md)\] | List of status checks that must pass before branches can be merged                                                                                                                                |                                                                                                                                                                                                                                                                                                                      |
| _requires_conversation_resolution_ | boolean                                | If enabled, all conversations on code must be resolved before a pull request can be merged into a matching branch                                                                                 |                                                                                                                                                                                                                                                                                                                      |
| _requires_commit_signatures_       | boolean                                | If enabled, commits pushed to matching branches must have verified signatures                                                                                                                     |                                                                                                                                                                                                                                                                                                                      |
| _requires_linear_history_          | boolean                                | If enabled, prevent merge commits from being pushed to matching branches                                                                                                                          |                                                                                                                                                                                                                                                                                                                      |
| _requires_deployments_             | boolean                                |                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                      |
| _required_deployment_environments_ | list[string]                           |                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                      |
| _lock_branch_                      | boolean                                | If enabled, matching branches are read-only, users cannot push to the branch                                                                                                                      |                                                                                                                                                                                                                                                                                                                      |
| _lock_allows_fetch_and_merge_      | boolean                                | Whether users can pull changes from upstream when the branch is locked. Set to true to allow fork syncing. Set to false to prevent fork syncing                                                   |                                                                                                                                                                                                                                                                                                                      |
| _is_admin_enforced_                | boolean                                | If this branch protection rule is also enforced for admins and custom roles with the "bypass branch protections" permission                                                                       |                                                                                                                                                                                                                                                                                                                      |
| _push_restrictions_                | list\[[Actor](actor.md)\]              | List of actors that are allowed to push to the protected branch(es)                                                                                                                               |                                                                                                                                                                                                                                                                                                                      |
| _allows_force_pushes_              | boolean                                | If force pushes to the protected branch(es) are allowed by anyone with write access to the repository                                                                                             | This property takes precedence over `bypass_force_push_allowances` if enabled, allowing all users with write access to force push                                                                                                                                                                                    |
| _bypass_force_push_allowances_     | list\[[Actor](actor.md)\]              | List of actors able to force push for this branch protection rule                                                                                                                                 | This property is only taken into account when `allows_force_pushes` is disabled                                                                                                                                                                                                                                      |
| _allows_deletions_                 | boolean                                | If deletion of the protected branch(es) is allowed by anyone with write access to the repository                                                                                                  |                                                                                                                                                                                                                                                                                                                      |
 
Note:

* `allows_force_pushes`: if this set to `True`, any actor with push permission can force push to the branch
* `bypass_force_push_allowances`: if the actor list is non-empty but `allows_force_pushes` is set to True, a validation error will be issued
* `push_restrictions`: the contents of the actor list controls whether push restriction is enabled or disabled, i.e. an empty list disables it
* `review_dismissal_allowances`: if the actor list is non-empty but `restricts_review_dismissals` is set to False, a validation error will be issued

## Jsonnet Function

``` jsonnet
orgs.newBranchProtectionRule('<pattern>') {
  <key>: <value>
}
```

## Validation rules

- specifying a non-empty list of `bypass_force_push_allowances` actors while `allows_force_pushes` is enabled, triggers a warning

## Example usage

=== "jsonnet"
    ``` jsonnet
    orgs.newOrg('adoptium') {
      ...
      _repositories+:: [
        ...
        orgs.newRepo('adoptium.net') {
          description: "Adoptium Website",
          homepage: "https://adoptium.net",
          branch_protection_rules: [
            orgs.newBranchProtectionRule('main') {
              required_approving_review_count: 1,
              required_status_checks+: [
                "Lint Code Base",
                "Run CI",
                "netlify:netlify/eclipsefdn-adoptium/deploy-preview"
              ],
            },
          ],
        },
      ],
    }
    ```
